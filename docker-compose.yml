version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    image: tallman-chat:dev
    container_name: tallman-chat-desktop
    ports:
      - "3230:3230"
      - "3231:3231"
      - "12435:12435"
    environment:
      - NODE_ENV=development
      - PORT=3231
      - UI_PORT=3230
      - GRANITE_PORT=12435
      - DATA_DIR=/app/data
      # Skill Compliance: Identity Governance Override
      - BACKDOOR_USERNAME=robertstar@aol.com
      - BACKDOOR_PASSWORD=admin
      # Skill Compliance: API Configuration
      - VITE_API_BASE_URL=http://localhost:3231
    env_file:
      - .env.docker
    volumes:
      # Skill Compliance: Mount project root for dev
      - .:/app
      # Skill Compliance: Shadow node_modules to use container binaries
      - /app/node_modules
      - /app/server/node_modules
      # Persistence for local development
      - ./data:/app/data
    restart: unless-stopped
    # Skill Compliance: Bootstrapping Entrypoint
    entrypoint: ["docker-entrypoint.sh"]
    command: ["sh", "-c", "npm run dev & node server/backend-server.js"]

